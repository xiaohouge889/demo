# 数据库配置说明

## 问题说明

如果启动服务器时看到 "数据库连接失败" 或 "ECONNREFUSED" 错误，说明 MySQL 数据库未正确配置。

## 解决方案

### 方案1：安装并配置 MySQL（推荐，完整功能）

#### 步骤1：安装 MySQL

**Windows 系统：**
1. 下载 MySQL：https://dev.mysql.com/downloads/mysql/
2. 选择 Windows 版本下载
3. 运行安装程序，选择 "Developer Default" 或 "Server only"
4. 设置 root 密码（记住这个密码）

**或使用集成环境（更简单）：**
- **XAMPP**：https://www.apachefriends.org/（包含 MySQL）
- **WAMP**：http://www.wampserver.com/（Windows）
- **MAMP**：https://www.mamp.info/（Mac）

#### 步骤2：创建数据库

1. 打开 MySQL 命令行或 phpMyAdmin
2. 执行以下 SQL 创建数据库：

```sql
CREATE DATABASE checkin_app CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

或者直接运行初始化脚本：

```bash
cd backend
npm run init-db
```

#### 步骤3：配置环境变量

在 `backend` 目录下创建 `.env` 文件（如果不存在），添加：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的MySQL密码
DB_NAME=checkin_app
```

#### 步骤4：重启服务器

```bash
npm run dev
```

### 方案2：暂时不使用数据库（仅前端测试）

如果暂时不想配置数据库，服务器仍然可以启动，但以下功能将不可用：
- ❌ 打卡功能
- ❌ 历史记录
- ❌ 设置保存
- ✅ 前端界面可以正常访问

服务器会显示警告信息，但不影响前端访问。

### 方案3：使用 SQLite（开发环境，可选）

如果需要更简单的数据库方案，可以后续修改代码使用 SQLite（不需要单独安装数据库服务）。

## 验证数据库连接

启动服务器后，访问：
```
http://localhost:3000/api/health
```

如果看到 `"database": "connected"`，说明数据库连接成功。

## 常见问题

### Q: MySQL 服务未启动
**A:** 
- Windows: 打开"服务"，找到 MySQL，右键"启动"
- 或使用 XAMPP/WAMP 的控制面板启动 MySQL

### Q: 连接被拒绝 (ECONNREFUSED)
**A:** 
- 检查 MySQL 服务是否运行
- 检查端口 3306 是否被占用
- 检查防火墙设置

### Q: 访问被拒绝 (ER_ACCESS_DENIED_ERROR)
**A:** 
- 检查用户名和密码是否正确
- 检查 `.env` 文件中的配置

### Q: 数据库不存在
**A:** 
- 运行 `npm run init-db` 创建数据库和表
- 或手动创建数据库（见步骤2）

## 快速开始（最小配置）

如果只是想快速测试前端界面，可以不配置数据库：

1. 直接启动服务器：`npm run dev`
2. 忽略数据库警告信息
3. 访问前端：http://localhost:5173

前端界面可以正常显示，但数据相关功能会报错（这是正常的）。
