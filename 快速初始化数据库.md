# 快速初始化数据库

## 问题

如果看到以下错误：
```
Unknown database 'checkin_app'
ER_BAD_DB_ERROR
```

说明 MySQL 服务已连接，但数据库 `checkin_app` 尚未创建。

## 解决方案

### 方法1：使用初始化脚本（推荐）

在项目根目录执行：

```bash
cd backend
npm run init-db
```

这个命令会自动：
- 创建数据库 `checkin_app`
- 创建所有必要的表（checkins、settings）
- 插入默认设置

### 方法2：手动执行 SQL

1. 打开 MySQL 客户端（命令行、phpMyAdmin 或其他工具）

2. 执行 `backend/database/init.sql` 文件中的所有 SQL 语句

或者直接复制以下 SQL 执行：

```sql
CREATE DATABASE IF NOT EXISTS checkin_app DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE checkin_app;

CREATE TABLE IF NOT EXISTS checkins (
  id INT PRIMARY KEY AUTO_INCREMENT,
  checkin_date DATE NOT NULL COMMENT '打卡日期',
  checkin_time DATETIME NOT NULL COMMENT '打卡时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  INDEX idx_date (checkin_date),
  INDEX idx_time (checkin_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='打卡记录表';

CREATE TABLE IF NOT EXISTS settings (
  id INT PRIMARY KEY AUTO_INCREMENT,
  setting_key VARCHAR(50) UNIQUE NOT NULL COMMENT '设置键',
  setting_value TEXT COMMENT '设置值',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX idx_key (setting_key)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统设置表';

INSERT INTO settings (setting_key, setting_value) VALUES
('emergency_email', ''),
('email_send_time', '09:00')
ON DUPLICATE KEY UPDATE setting_key = setting_key;
```

## 验证

初始化完成后，重启服务器，访问：
```
http://localhost:3000/api/health
```

如果看到 `"database": "connected"`，说明数据库配置成功。

## 注意事项

- 确保 MySQL 服务已启动
- 确保 `.env` 文件中的数据库配置正确
- 确保数据库用户名有创建数据库的权限
